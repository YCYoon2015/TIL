# 211116 TIL

> 프론트엔드와 백엔드를 연결하기 위해서 네트워크에 대한 개념들이 필요했다. 요청을 주고받을 때 보안에서 기본적인 개념 중 하나인 CORS를 MDN문서를 바탕으로 다양한 글을 참고해 공부하고 정리해본다.



## 교차 출처 리소스 공유 (CORS)

### 인트로

- Cross-Origin Resource Sharing의 약자로 약자만 봐서는 의미 파악이 쉽지 않다.
- CORS는 HTTP 헤더를 통해 접근 권한을 부여하고 브라우저에 알려주는 방법이다.
- 그런데 이걸 브라우저는 왜 알고 싶을까?



### 브라우저의 보안

- 브라우저는 서버로부터 http 요청 결과를 받는다. 
- 이때 자신의 출처(도메인, 프로토콜, 포트)가 다르다면 외부에서 온 악성 파일일 가능성이 있으므로 이를 차단한다. 이러한 보안 방식을 교차 출처 차단이라고 한다.
  - 예를들면, `https://domain-a.com` 프론트엔드 코드가 `https://domain-b.com/data.json`에 XHR요청을 보낸다면 브라우저는 도메인이 다르므로 이를 차단한다.
  - 브라우저가 A 도메인에 요청을 했는데, 다시 B에도 요청을 보내야하는 상황을 차단한느 것이다.
- 따라서 서버에서 교차 출처를 원하는 다른 API를 미리 알려주어 허용시켜야 한다. 이러한 표시를 http 헤더에 남길 수 있다.



### CORS를 사용하는 요청의 예시

- XHR과 Fetch API 호출
  - XHR은 AJAX요청을 생성하는 JS API이다. (서버와 상호작용하는 방법)
  - XHR보다 강력하고 유연한 API이다. 네트워크 요청/응답에 관련된 일반적인 Request/Response object 제공을 통해 프로그래밍 언어로 직접 조작해서 필요한 기능을 사용할 수 있다.
- 웹 폰트(CSS 내 `@font-face`에서 교차 도메인 폰트) 사용
  - 웹폰트는 설치 하지않고 사용가능한 폰트 적용방식이다. 하지만 사용시 파일크기와 전송속도, 렌더링 방식 등 고려해야한다. 
  - CSS는 내가 사용하는 서버와 다른 도메인에 소스가 있고, 따라서 CORS가 발생 한다.
- WebGL(Web Graphics Library) 텍스쳐
  - 웹상에서 2D 및 3D 그래픽을 렌더링하기 위한 로우 레벨 Javascript API이다. OpenGL ES 2.0을 기반으로 브라우저 엔진에 내장된 HTML5 Canvas 요소 위에 그려진다.
  - 플러그인이 필요없는 웹 기반 그래픽 라이브러리이기때문에 역시 CORS를 고려해야한다.



### 동작 방식 (사용 방식)

- 결국 CORS가 내가 원하는 서버를 막는것을 방지하기 위해서 헤더에 허용 사이트를 추가한다.
- GET을 제외한 Method에서 서버에 예비요청을 보내서 'Access-Control-Allow_Origin'과 같이 허용가능하다는 허가(서버가 무슨 요청을 허가하는지)를 브라우저에게 보여주고 다음에 본 요청을 보내는 방식으로 유효성 검사를 한다.



### CORS 해결하기

- Access-Control-Allow-Origin 세팅하기
  - 정석대로 헤더에 알맞는 Access-Control-Allow-Origin값을 세팅하면 된다. `*`를 이용하면 모든 요청을 허용할 수 있으나 이런식으로 만들 이유가 없다.
- Webpack Dev Server로 리버스 프록싱하기
  - 프론트 개발을 위해 API를 이용할 때 Webpack Dev Server 라이브러리를 통해 CORS 정책을 우회할 수 있다. 이는 로컬 환경에서 개발하기 위함이다.





CORS 위반은 브라우저에서 발생하는 문제로 보통 프론트엔드 개발자가 해결하는 과제일것이다. 하지만 설정은 백엔드에서 해줘야 하는 문제이므로 백엔드가 개발시 이러한 고려를 충분히 해서 API를 제공해야한다.



> ref.
>
> https://developer.mozilla.org/ko/docs/Web/HTTP/CORS
>
> https://evan-moon.github.io/2020/05/21/about-cors/

